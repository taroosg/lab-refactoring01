<!doctype html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>学生成績処理システム</title>
</head>

<body>
  <h1>学生成績処理システム</h1>
  <p>
    ブラウザの開発者ツールでコンソールを開いて結果を確認してください。
  </p>

  <script>
    // 学生データ（実際のシステムではファイルやデータベースから読み込む想定）
    const studentData = [
      { name: "空条承太郎", math: 92, english: 88, science: 98 },
      { name: "吉良吉影", math: 85, english: 78, science: 92 },
      { name: "東方仗助", math: 65, english: 72, science: 68 },
      { name: "広瀬康一", math: 78, english: 95, science: 82 },
      { name: "岸辺露伴", math: 88, english: 76, science: 90 },
      { name: "虹村億泰", math: 58, english: 64, science: 62 },
    ];

    // 全ての処理を1つの関数で実行（リファクタリング前）
    function processStudentGrades() {
      console.log("=== 学生成績処理システム開始 ===");

      // 各学生の成績を処理
      const results = [];
      for (let i = 0; i < studentData.length; i++) {
        const student = studentData[i];

        // 平均点を計算
        const total = student.math + student.english + student.science;
        const average = Math.round((total / 3) * 10) / 10; // 小数点第1位まで

        // 合否判定（平均70点以上で合格）
        let status = "";
        let grade = "";
        if (average >= 90) {
          status = "合格";
          grade = "A";
        } else if (average >= 80) {
          status = "合格";
          grade = "B";
        } else if (average >= 70) {
          status = "合格";
          grade = "C";
        } else {
          status = "不合格";
          grade = "D";
        }

        // 結果をまとめる
        const result = {
          name: student.name,
          math: student.math,
          english: student.english,
          science: student.science,
          total: total,
          average: average,
          status: status,
          grade: grade,
        };

        results.push(result);
      }

      // 結果を表示
      console.log("\n--- 個別成績結果 ---");
      for (let i = 0; i < results.length; i++) {
        const r = results[i];
        console.log(
          `${r.name}: 数学${r.math} 英語${r.english} 理科${r.science} | 合計${r.total} 平均${r.average} ${r.status}(${r.grade})`,
        );
      }

      // 統計情報を計算・表示
      console.log("\n--- 統計情報 ---");

      // 合格者数と合格率
      let passCount = 0;
      for (let i = 0; i < results.length; i++) {
        if (results[i].status === "合格") {
          passCount++;
        }
      }
      const passRate = Math.round((passCount / results.length) * 100);
      console.log(
        `合格者数: ${passCount}名 / ${results.length}名 (合格率: ${passRate}%)`,
      );

      // 各科目の平均点
      let mathTotal = 0,
        englishTotal = 0,
        scienceTotal = 0;
      for (let i = 0; i < studentData.length; i++) {
        mathTotal += studentData[i].math;
        englishTotal += studentData[i].english;
        scienceTotal += studentData[i].science;
      }
      const mathAvg = Math.round((mathTotal / studentData.length) * 10) / 10;
      const englishAvg =
        Math.round((englishTotal / studentData.length) * 10) / 10;
      const scienceAvg =
        Math.round((scienceTotal / studentData.length) * 10) / 10;

      console.log(
        `科目別平均点: 数学${mathAvg} 英語${englishAvg} 理科${scienceAvg}`,
      );

      // 成績分布
      let gradeA = 0,
        gradeB = 0,
        gradeC = 0,
        gradeD = 0;
      for (let i = 0; i < results.length; i++) {
        switch (results[i].grade) {
          case "A":
            gradeA++;
            break;
          case "B":
            gradeB++;
            break;
          case "C":
            gradeC++;
            break;
          case "D":
            gradeD++;
            break;
        }
      }

      console.log(
        `成績分布: A評価${gradeA}名 B評価${gradeB}名 C評価${gradeC}名 D評価${gradeD}名`,
      );

      // 各科目の最高点・最低点
      console.log("\n--- 科目別詳細統計 ---");
      let mathScores = [],
        englishScores = [],
        scienceScores = [];
      for (let i = 0; i < studentData.length; i++) {
        mathScores.push(studentData[i].math);
        englishScores.push(studentData[i].english);
        scienceScores.push(studentData[i].science);
      }

      // 数学の統計
      let mathMax = Math.max(...mathScores);
      let mathMin = Math.min(...mathScores);
      let mathMaxStudent = "",
        mathMinStudent = "";
      for (let i = 0; i < studentData.length; i++) {
        if (studentData[i].math === mathMax)
          mathMaxStudent = studentData[i].name;
        if (studentData[i].math === mathMin)
          mathMinStudent = studentData[i].name;
      }
      console.log(
        `数学: 最高${mathMax}点(${mathMaxStudent}) 最低${mathMin}点(${mathMinStudent}) 平均${mathAvg}点`,
      );

      // 英語の統計
      let englishMax = Math.max(...englishScores);
      let englishMin = Math.min(...englishScores);
      let englishMaxStudent = "",
        englishMinStudent = "";
      for (let i = 0; i < studentData.length; i++) {
        if (studentData[i].english === englishMax)
          englishMaxStudent = studentData[i].name;
        if (studentData[i].english === englishMin)
          englishMinStudent = studentData[i].name;
      }
      console.log(
        `英語: 最高${englishMax}点(${englishMaxStudent}) 最低${englishMin}点(${englishMinStudent}) 平均${englishAvg}点`,
      );

      // 理科の統計
      let scienceMax = Math.max(...scienceScores);
      let scienceMin = Math.min(...scienceScores);
      let scienceMaxStudent = "",
        scienceMinStudent = "";
      for (let i = 0; i < studentData.length; i++) {
        if (studentData[i].science === scienceMax)
          scienceMaxStudent = studentData[i].name;
        if (studentData[i].science === scienceMin)
          scienceMinStudent = studentData[i].name;
      }
      console.log(
        `理科: 最高${scienceMax}点(${scienceMaxStudent}) 最低${scienceMin}点(${scienceMinStudent}) 平均${scienceAvg}点`,
      );

      // 平均点による順位付け
      console.log("\n--- 成績順位 ---");
      // 平均点でソート（降順）
      const sortedResults = [];
      for (let i = 0; i < results.length; i++) {
        sortedResults.push(results[i]);
      }
      // バブルソート実装（理解しやすさのため）
      for (let i = 0; i < sortedResults.length - 1; i++) {
        for (let j = 0; j < sortedResults.length - 1 - i; j++) {
          if (sortedResults[j].average < sortedResults[j + 1].average) {
            let temp = sortedResults[j];
            sortedResults[j] = sortedResults[j + 1];
            sortedResults[j + 1] = temp;
          }
        }
      }

      for (let i = 0; i < sortedResults.length; i++) {
        const rank = i + 1;
        const student = sortedResults[i];
        console.log(
          `${rank}位: ${student.name} 平均${student.average}点 (${student.grade}評価)`,
        );
      }

      console.log("\n=== 処理完了 ===");
    }

    // 処理を実行
    processStudentGrades();
  </script>
</body>

</html>